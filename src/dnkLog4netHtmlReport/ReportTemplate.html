<!DOCTYPE html>
<html>
<head>
	<title>Report Template</title>
	<meta charset="UTF-8">

	<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.6.1/prop-types.js"></script>

	<script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
	<script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.21.1/babel.min.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/redux/4.0.0/redux.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react-redux/5.0.7/react-redux.min.js"></script>

	<script type="text/babel">
		const levelToColor = {
			debug: 'gray',
			pass: 'limegreen',
			info: 'lightskyblue',
			failskip: 'gold',
			warn: 'coral',
			retry: 'greenyellow',
			fail: 'red',
		};
	</script>

	<style>
	*
	{
		font-family: Helvetica, Arial, sans-serif;
	}

	label
	{
		color: DimGray;
	}

	a:link
	{
		color: DimGray;
		background-color: transparent;
		text-decoration: none;
	}

	a:visited
	{
		color: DimGray;
	}

	.crossedOut {
		text-decoration: line-through !important;
	}

	/* Styles for statuses (Fail, Pass, Info etc). */
	tr.retry > td.summaryStatus > span, tr.fail > td.summaryStatus > span, tr.pass > td.summaryStatus > span, tr.info > td.summaryStatus > span, tr.warn > td.summaryStatus > span, tr.failskip > td.summaryStatus > span, tr.debug > td.summaryStatus > span,
	tr.retry > td.statusCol > span,     tr.fail > td.statusCol > span,     tr.pass > td.statusCol > span,     tr.info > td.statusCol > span,     tr.warn > td.statusCol > span,     tr.failskip > td.statusCol > span,     tr.debug > td.statusCol > span
	{
		color: White;
		float: left;
		width: 65px;
		padding: 2px 5px;
		margin: 2px;
		-moz-border-radius: 5px;
		border-radius: 5px;
	}

	.statusDebug, .statusdebug { color: gray !important; }
	.statusPass, .statuspass { color: limegreen !important; }
	.statusInfo, .statusinfo { color: lightskyblue !important; }
	.statusFailSkip, .statusfailskip { color: gold !important; }
	.statusWarn, .statuswarn { color: coral !important; }
	.statusRetry, .statusretry { color: GreenYellow !important; }
	.statusFail, .statusfail { color: red !important; }

	tr.debug > td.summaryStatus > span, tr.debug > td.statusCol > span
	{
		background-color: gray;
		text-align: center;
	}

	tr.pass > td.summaryStatus > span, tr.pass > td.statusCol > span
	{
		background-color: limegreen;
		text-align: center;
	}

	tr.retry > td.summaryStatus > span, tr.retry > td.statusCol > span
	{
		background-color: GreenYellow;
		text-align: center;
	}

	tr.fail > td.summaryStatus > span, tr.fail > td.statusCol > span
	{
		background-color: red;
		text-align: center;
	}

	tr.failskip > td.summaryStatus > span, tr.failskip > td.statusCol > span
	{
		background-color: gold;
		text-align: center;
	}

	tr.info > td.summaryStatus > span, tr.info > td.statusCol > span
	{
		background-color: lightskyblue;
		text-align: center;
	}

	tr.warn > td.summaryStatus > span, tr.warn > td.statusCol > span
	{
		background-color: coral;
		text-align: center;
	}

	table.summary
	{
		border-collapse: separate;
		border-spacing: 0px 3px;
		font-size: 12pt;
		width: 100%;
		margin-top: 10px;
	}

	tr.summaryRow
	{
		background-color: #efeeee;
		cursor: pointer;
		padding-top: 10px;
		border-collapse: collapse;
	}
	tr.summaryRow td:first-child { border-top-left-radius:  8px; border-bottom-left-radius:  8px;   border-left: 1px solid gray; }
	tr.summaryRow td:last-child  { border-top-right-radius: 8px; border-bottom-right-radius: 8px; border-right: 1px solid gray;}

		tr.summaryRow > td
		{
			border-top: 1px solid gray;
			border-bottom: 1px solid gray;
			padding: 3px;
			white-space: nowrap;
		}

	.summaryDetailsRow > td
	{
		padding: 0;
	}

	.summaryDetailsRow > td:last-child {
		padding-right: 5px;
	}

	.square
	{
		border: 1px solid limegreen;
		float: left;
		width: 6px;
		height: 6px;
		background-color: limegreen;
		margin: 2px;
		-moz-border-radius: 6px;
		border-radius: 6px;
	}

	.debug .square {
		background-color: gray !important;
		border-color: gray !important;
	}

	.pass .square {
		background-color: limegreen !important;
		border-color: limegreen !important;
	}

	.retry .square {
		background-color: GreenYellow !important;
		border-color: GreenYellow !important;
	}

	.fail .square {
		background-color: red !important;
		border-color: red !important;
	}

	.failskip .square {
		background-color: gold !important;
		border-color: gold !important;
	}

	.info .square {
		background-color: lightskyblue !important;
		border-color: lightskyblue !important;
	}

	.warn .square {
		background-color: coral !important;
		border-color: coral !important;
	}


	table.details
	{
		border-collapse: collapse;
		font-size: 12pt;
		margin-bottom: 20px;
		width: 100%;
	}

		table.details > tbody > tr > td
		{
			border: 1px solid gray;
			padding: 3px;
		}

	tr.detailsHeaderRow
	{
		font-weight: bold;
	}

		tr.detailsHeaderRow > td
		{
			border-top: none !important;
		}

	tr.header > td
	{
		font-family: Helvetica, Arial, sans-serif;
		border-top: none !important;
	}

	td.summaryStatus
	{
		font-weight: bold;
		width: 80px;
	}

	td.summaryTestName
	{
		font-weight: normal;
	}

	td.summaryStartEnd
	{
		width: 145px;
	}

	td.summaryDuration
	{
		width: 140px;
	}

	td.timeCol
	{
		width: 70px;
	}

	td.statusCol
	{
		width: 80px;
	}

	tr.detailsExceptionRow > td > div, .detailsException
	{
		font-family: monospace;
		white-space: pre-wrap;
		max-height: 20em;
		overflow: scroll;
	}

	a.screenshot {
		float: left; margin-right: 5px;
	}

	.pageNavigation {
		color: RGB(0,154,250)
	}

	.exceptionCol {
		font-size: 85%;
	}

		span.screenshotIcon::before
		{
			content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAC4jAAAuIwF4pT92AAAFEklEQVR42p1Ve1BUVRy+YP/1h+k4Kaiw7vIKcM0adabyn2aapmzGtBkQEU0SMIZ8ZFIW7K67Aj5gWNjlpe6qgPhCcQZmV7SpRNOy8dFTx7EUQ1QItNDdvfecc7/OuYsPcjFrZ7577tl77u873+/7nd+VLBaLZDabJYvFLJnMa6V1pjVSWUGeVFrwwbAQz21rVkhmi/WpB+9bQuL+jdlsCbNZCqV8W3nkW+Wnyt4sP+OaVX5m66zys66hOL35dfs594fO1sW2gnyxqRGPI5HuP7TaRny6Kk+aYT1Zr3cDsbUcdaERXQ1ktQMbdhzKM635iCtZO6wS7VJYWCgVFZeELVmULunzjx02uqmSXBXwT64hSgiQeKesZLURpehbYK37UJ75MSTaxWQyScUl68MzM+ZJMauPeiZvA5KqFSW5luGfSKqlalwVRXYbVW0dlJi+BqzuoBKT2RJMVygCriD8vYVpUkx+h0aQWKUQYx3DlLrBwDUPSGKdRM1qo9h0UlWtxxgpOgWU1LfnrSv8WCgJf1jFEAWDBN5kt6aATKpkiKpgSKh+iKSGIoEreMlN1aWtfuS23lXfb/WR3MMqlttbsk2fDSV5hMCwusNrDKaILGhhyPUwvLwtGFwoMtZRGGupNo93+NS49V0wFHcqsfY7alTuwaM5mRnSOp4NETOEB0EFCS5gbKlCzvcwAAxz9zA8s5EhmiuaWDEIO+VzFTq7rD63qZskOf1qVPbutnfTU0SsMFE4jxBkcQURKzq8OUeAw5cU0jPAwBjDDzcYvrrMcLzzHiiO8fHLyxT13/MUOnwksVpBdM5eT2ZGquZnSAXZi9KkUXkd3rIzfONQiKoy3JUZbg5Q9PsYbvmIhv67DD13qKbu2p8U8U6FTOa+6Zbu92YuSNVihSQQHkSv6vC+tg9YfFAh3X8x/Mh3H10hPKAwOKFBGD3BzvDdNYrOW7yqKmVi3KFi0jKPNzOYouE9iB30YMxGhVzsZTjfQ6GvlHm+KUyeXbAeatC80PH/TnczdHEFMQ6uYDtXsNz77wpEFU3hi+P4S7/2Ufxyk8FQqWA83/mrO7rxRv1viOL3gvDsdYrfb3MFDqEAQQULUh5PIKrIyAkMXPalPxgu9CgYYweKdjbhldpeRDiApuYSxFQGcKILmgexfDOCQLfsCRTcI9BXKuRKn4JvrgPzXfyofqHD6ZY02JtqgM9Hw7WnFD/dGMDVW5SXaoAk8bMziadocfoTEhgqZHKhj1dJ7zV0H5gB2qYHWkZxPA3loA5oHQ/0H8XF28BMl49Mb+Rp+y8KYniKfu5VAdoNXG0COncCVxo4+Ni1n8/3gt7pQoCKsxIgNt5ZR+V4vVkZT0Agmp3IqzhQfX7ghgz0Kg+Bz/sJIPOjMBCguO1XSOFJYDQnWDIcQZEg4O3aMNiuE6tk8uIWhmlbKaZtke9jOkdStYz0A5wFFOKsTK2TydQGYbLHM2wViQ+OpuCTE+3JWwlJdPj8CU6ZJDgCJMEZCI6D0HNTZ7oDpPFcgJQdl0ms3edPdhGiX3mkXXggYg0hEI2pZP2G8EWpc6SIzMZdU3mKRdlNaQiN57mhyfVA1BZeOa7g2hf4O+PSN+9emPq2FmtIsxO922q1heWvWimNjDDEjZ1bvC1yfnVzxDznvoi0quZQiOSYmF7VPGG+c59Y++ycou0jx+niRQwRa8j3QFNRUCBt3FQqpcydLf3fX8o7s7UYIta9uH8Dkzb9MDhq7RMAAAAASUVORK5CYII=);
		}

	#headerLeft {
		margin-right: 10px;
		float: left;
		max-width: 580px;
	}
	#headerLeft > h1 {
		margin-top: 0px;
	}
	#headerRight {
		float: right;
	}
	#headerRight > div {
		width: 400px;
		height: 300px;
		border: 0px solid lightgray;
	}
	.clearBoth {
		clear: both;
	}
	</style>
</head>

<body>
	<div style="width: 1000px;">
		<div id="header">
			<!-- Header of the report -->
			<div id="headerLeft">
			</div>
			<div id="headerRight">
				<div>
					<canvas id="myCanvas" style="background-color: white;"></canvas>
				</div>
			</div>
			<div className="clearBoth"></div>
		</div>
		<div id="content">
		</div>
	</div>
	<script type="text/babel">
		//////////////////////////////////// lib //////////////////////////////////////
		var groupBy = function(list, key) {
			return list.reduce(function(accumulator, currentValue) {
				(accumulator[currentValue[key]] = accumulator[currentValue[key]] || []).push(currentValue);
				return accumulator;
			}, {});
		};

		var calcDuration = function(/*Date*/ startTime, /*Date*/ endTime) {
			var durationStr = "";

			// Set the unit values in milliseconds.
			var msecPerMinute = 1000 * 60;
			var msecPerHour = msecPerMinute * 60;
			var msecPerDay = msecPerHour * 24;
			// Get the difference in milliseconds.
			var interval = endTime.getTime() - startTime.getTime();

			// Calculate how many days the interval contains. Subtract that
			// many days from the interval to determine the remainder.
			var days = Math.floor(interval / msecPerDay );
			if(days > 0) durationStr = days + "d "
			interval = interval - (days * msecPerDay );

			// Calculate the hours, minutes, and seconds.
			var hours = Math.floor(interval / msecPerHour );
			if(hours > 0) durationStr = durationStr + hours + "h "
			interval = interval - (hours * msecPerHour );

			var minutes = Math.floor(interval / msecPerMinute );
			if(minutes > 0) durationStr = durationStr + minutes + "m "
			interval = interval - (minutes * msecPerMinute );

			var seconds = Math.floor(interval / 1000 );
			durationStr = durationStr + seconds + "s "

			return durationStr;
		};

		const timeOnlyFormatter = new Intl.DateTimeFormat('en-US', {hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: false});
		const TagContainer = props => props.children;
		//////////////////////////////////// end of lib //////////////////////////////////////

		//////////////////////////////////// data prep //////////////////////////////////////

		const detailsRows = [
			{"EndOfReportData":true} // logger will add data into reportData array during tests execution
		];

		detailsRows.splice(-1,1)

		for (var i = 0; i < detailsRows.length; i++) {
			detailsRows[i].TimeStampUtc = new Date(detailsRows[i].TimeStampUtc);
		}

		class SummaryDataRow {
			constructor(detailsRows) {
				this.detailsRows = detailsRows;
				this.tempBrowser = detailsRows[0].Browser;

				this.level = this.detailsRows
					.reduce((accumulator, currentValue) => currentValue.LevelValue > accumulator.LevelValue ? currentValue : accumulator, this.detailsRows[0])
					.Level;
				this.startTime =  this.detailsRows
					.reduce((accumulator, currentValue) => currentValue.TimeStampUtc < accumulator.TimeStampUtc ? currentValue : accumulator, this.detailsRows[0])
					.TimeStampUtc;
				this.endTime = this.detailsRows
					.reduce((accumulator, currentValue) => currentValue.TimeStampUtc > accumulator.TimeStampUtc ? currentValue : accumulator, this.detailsRows[0])
					.TimeStampUtc;
				this.durationMsec = this.endTime.getTime() - this.startTime.getTime();
				this.durationStr = calcDuration(this.startTime, this.endTime);
				this.relativeDuration = 0;
			};

			get fullTestCaseName() { return this.detailsRows[0].FullTestCaseName; }
		}

		const groupsObject = groupBy(detailsRows, 'FullTestCaseName');

		var summaryRows = Object.keys(groupsObject).map(key => new SummaryDataRow(groupsObject[key]));
		const maxDuration = summaryRows.reduce(
			(accumulator, currentValue) => { return accumulator.durationMsec < currentValue.durationMsec ? currentValue : accumulator; },
			summaryRows[0]);
		summaryRows.map(summaryRow => {
			summaryRow.relativeDuration = Math.round(summaryRow.durationMsec / maxDuration.durationMsec * 10);
		});

		//////////////////////////////////// end of data prep //////////////////////////////////////

		//////////////////////////////////// Application State //////////////////////////////////////

		function expandRowsReducer(state, action) {
			var newState = {expandedRows: []};
			if (typeof state === 'undefined') {
				return newState;
			}

			switch (action.type) {
				case 'TOGGLE_ROW':
					var rowIDindex = state.expandedRows.indexOf(action.rowID);
					if(rowIDindex == -1)
						newState = {expandedRows: [...state.expandedRows, action.rowID]};
					else
						newState = {expandedRows: [...(state.expandedRows.slice(0, rowIDindex)), ...(state.expandedRows.slice(rowIDindex + 1))]};
					break;
				case 'TOGGLE_ALL_ROWS':
					if(state.expandedRows.length > 0)
						newState = {expandedRows: []};
					else
						newState = {expandedRows: summaryRows.map(summaryRow => summaryRow.fullTestCaseName)};
					break;
			}
			return newState;
		}

		const toggleRow = rowID => ({ type: "TOGGLE_ROW", rowID: rowID });
		const toggleAllRows = () => ({ type: "TOGGLE_ALL_ROWS" });

		const mapStateToProps = state => {
			return { expandedRows: state.expandedRows };
		};

		const mapDispatchToProps = dispatch => {
			return {
				toggleRow: rowID => dispatch(toggleRow(rowID)),
				toggleAllRows: () => dispatch(toggleAllRows())
			};
		};

		var store = Redux.createStore(expandRowsReducer);

		//////////////////////////////////// End of Application State //////////////////////////////////////

		//////////////////////////////////// Render Tests Execution Table //////////////////////////////////////

		const SummaryTable = ({summaryRows}) => {
			return (
				<table className='summary'>
					{ summaryRows.map(summaryRow => <ConnectedSummaryRow key={summaryRow.fullTestCaseName} store={store} summaryRow={summaryRow}/>) }
				</table>
			);
		};

		class SummaryRow extends React.Component {
			constructor(props) {
				super(props);
			}

			/*bool*/ isExpanded() {
				return this.props.store.getState().expandedRows.indexOf(this.props.summaryRow.fullTestCaseName) >= 0;
			}

			render() {
				const level = this.props.summaryRow.level;
				let anchorID = 0;
				const relativeDurationHack = [];
				for(let i = 0; i < this.props.summaryRow.relativeDuration; i++) relativeDurationHack.push(i);
				return (
					<tbody>
						<tr className={`summaryRow ${level.toLowerCase()}`} onClick={() => this.props.toggleRow(this.props.summaryRow.fullTestCaseName)}>
							<td className='summaryStatus'><span>{level}</span></td>
							<td className='summaryTestName'>{/*<a href="#issue21"><b>&dArr;</b></a>&nbsp;*/}{this.props.summaryRow.fullTestCaseName}</td>
							<td className='summaryStartEnd'>{timeOnlyFormatter.format(this.props.summaryRow.startTime)} - {timeOnlyFormatter.format(this.props.summaryRow.endTime)}</td>
							<td className='summaryDuration' title={`Duration: ${this.props.summaryRow.durationStr}`}>
								<div style={{width: '52px'}}></div>
								{relativeDurationHack.map(x => (<span key={x} className='square'></span>))}
							</td>
						</tr>
						{ this.isExpanded() && (
							<tr className={`summaryDetailsRow ${level.toLowerCase()}`}>
								<td>&nbsp;</td>
								<td colSpan="3">
									<table className='details'>
										<tbody>
											{
												this.props.summaryRow.detailsRows.map(detailsRow => {
													if(anchorID == 0 && detailsRow.LevelValue >= 60000) {
														anchorID = detailsRow.ID;
													}
													return (
														<DetailsRow key={detailsRow.ID} detailsRow={detailsRow} anchorID={anchorID}/>
													);
												})
											}
										</tbody>
									</table>
								</td>
							</tr>
						) }
					</tbody>
				)
			}
		}

		const DetailsRow = ({detailsRow, anchorID}) => {
			return (
				<TagContainer>
					<tr className={`detailsRow ${detailsRow.Level.toLowerCase()}`}>
						<td className='timeCol' title={`[${detailsRow.ThreadName}]`}>{timeOnlyFormatter.format(detailsRow.TimeStampUtc)}</td>
						<td className='statusCol'><span>{detailsRow.Level}</span></td>
						<td className='messageCol'>
							{anchorID > 0 && <a name={`issue${anchorID}`}></a>}
							{detailsRow.ScreenshotPath != null && (
								<span><a className='screenshot' target='_blank' href={detailsRow.ScreenshotPath}><span className='screenshotIcon' title='Open Screenshot'></span></a></span>
							)}
							{detailsRow.Message}
						</td>
					</tr>
					{detailsRow.Exception != null &&
					<tr className='detailsExceptionRow'>
						<td className='exceptionCol' colSpan='3'>
							<div>{detailsRow.Exception}</div>
						</td>
					</tr>
					}
				</TagContainer>
			);
		};

		const ConnectedSummaryRow = ReactRedux.connect(mapStateToProps, mapDispatchToProps)(SummaryRow);

		ReactDOM.render(
			<SummaryTable store={store} summaryRows={summaryRows}/>,
			document.getElementById('content')
		);

		//////////////////////////////////// Render Header //////////////////////////////////////

		var reportMetaData = {};
		document.title = reportMetaData.ReportName + ' ' + reportMetaData.ReportEnvironment + ' ' + reportMetaData.ReportCategory;

		var startTime = summaryRows
			.reduce((accumulator, currentValue) => currentValue.startTime < accumulator.startTime ? currentValue : accumulator, summaryRows[0])
			.startTime;
		var endTime = summaryRows
			.reduce((accumulator, currentValue) => currentValue.endTime > accumulator.endTime ? currentValue : accumulator, summaryRows[0])
			.endTime;

		var levelBrowserUnique = {};
		summaryRows.map(item => {
			let key = item.level;
			if(item.tempBrowser) key = key + ' ' + item.tempBrowser;
			if(levelBrowserUnique[key]) levelBrowserUnique[key].Count = levelBrowserUnique[key].Count + 1;
			else levelBrowserUnique[key] = {Count: 1, Level: item.level, Browser: item.tempBrowser};
		});

		const PageSummary = ({reportMetaData}) => {
			return (
				<div>
					<h1 id="reportTitle">{reportMetaData.ReportName}</h1>
					<h4 id="environmentInfo"><label>Environment:</label> <span id="environment">{reportMetaData.ReportEnvironment}</span></h4>
					<h4 id="testCategory"><label>Category:</label> <span id="category">{reportMetaData.ReportCategory}</span></h4>
					<h4 id="timeInfo"><label>Start:</label> <span id="startTime">{timeOnlyFormatter.format(startTime)}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<label>End:</label> <span id="endTime">{timeOnlyFormatter.format(endTime)}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<label>Duration:</label> <span id="duration">{calcDuration(startTime, endTime)}</span></h4>

					<LevelsBrowsers levelBrowser={levelBrowserUnique}/>
					<div>
						<ConnectedExpandCollapseAll store={store}/>&nbsp;&nbsp;
						{/*<StepLevels detailsRows={detailsRows}/>*/}
					</div>
				</div>
			);
		};

		const LevelsBrowsers = ({levelBrowser}) => {
			return (
				<h4 id="passFailInfo">
					<div style={{float: 'left', marginRight: '20px'}}>
						<label>Tests Run:</label> <span>{summaryRows.length}</span>
					</div>
					{
						Object.keys(levelBrowser).map((key, index) => {
							let level = levelBrowser[key].Level.toLowerCase();
							level = level.charAt(0).toUpperCase() + level.substr(1);
							const count = levelBrowser[key].Count;
							return (
								<div key={key} style={{float: 'left', marginRight: '20px'}}>
									<label className={`status${level}`}>{key}:</label> <span className={`status${level}`}>{count}</span>
								</div>
							);
						})
					}
					<div className="clearBoth"></div>
				</h4>
			);
		};

		const StepLevels = ({detailsRows}) => {
			return (
				<span>
					[<span id="stepNames">
						{
							Object.keys(groupBy(detailsRows, 'Level')).map(key => {
								return (
									<a key={key} href="javascript:void(0)" style={{marginLeft: '5px', marginRight: '5px'}} className={`status${key.toLowerCase()}`}>{key}</a>
								);
							})
						}
					</span>]
				</span>
			);
		};

		class ExpandCollapseAll extends React.Component {
			constructor(props) {
				super(props);
			}

			render() {
				return (
					<span>
						[ <a id="expandCollapseAll" href="javascript:void(0)" onClick={() => this.props.toggleAllRows()}>
						{this.props.store.getState().expandedRows.length > 0 ? 'Collapse' : 'Expand'} All Rows</a> ]
					</span>
				)
			}
		};

		const ConnectedExpandCollapseAll = ReactRedux.connect(mapStateToProps, mapDispatchToProps)(ExpandCollapseAll);

		ReactDOM.render(
			<PageSummary reportMetaData={reportMetaData}/>,
			document.getElementById('headerLeft')
		);
	</script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js"></script>
	<script type="text/babel">
		//////////////////////////////////// Pie Charts //////////////////////////////////////
		var levelGroupped = groupBy(summaryRows, 'level');

		const levelCounts = [];
		const levelBgColors = [];
		const levelBorderColors = [];
		const levelHoverBorderColor = [];
		const levelLabels = [];
		Object.keys(levelGroupped).map(key => {
			levelCounts.push(levelGroupped[key].length);
			levelBgColors.push(levelToColor[key.toLowerCase()]);
			levelBorderColors.push('white');
			levelHoverBorderColor.push('white');
			levelLabels.push(key);
		});

		var data = {
			datasets: [{
				data: levelCounts,
				backgroundColor: levelBgColors,
				borderColor: levelBorderColors,
				hoverBorderColor: levelHoverBorderColor,
				label: 'Tests' // for legend
			}],
			labels: levelLabels
		};
		var canvas = document.getElementById("myCanvas");
		var ctx = canvas.getContext("2d");
		$(function () {
			new Chart(ctx, {
				data: data,
				type: "pie",
				options: {
					maintainAspectRatio: false,
					/*
					LOOK INTO http://jsfiddle.net/5gyfykka/
					tooltipTemplate: "<%= value %>",
					onAnimationComplete: function () {
						this.showTooltip(this.segments, true);
					},
					tooltipEvents: [],*/
					showTooltips: true,
					elements: {
						arc: {
							borderColor: "#000000"
						}
					}
				}
			});
		});
	</script>
</body>
</html>